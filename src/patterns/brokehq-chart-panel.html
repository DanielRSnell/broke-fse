<!-- BrokeHQ Chart Panel (Right Sidebar) -->
<aside class="border-l border-neutral-200 bg-white/70 backdrop-blur hidden xl:block">
  <!-- Project Header -->
  <div class="p-4 border-b border-neutral-200">
    <div class="flex items-center justify-between">
      <div>
        <div class="text-[11px] text-neutral-600">
          {{ project.status }} Â· {{ project.meta('start_date') | date('M j') }} â†’ {{ project.meta('deadline') | date('M j') }}
        </div>
        <h2 class="mt-1 font-geist text-2xl font-light tracking-tight">{{ project.title }}</h2>
      </div>
      <button class="p-2 rounded-md hover:bg-neutral-100">
        <i data-lucide="more-horizontal" class="w-5 h-5"></i>
      </button>
    </div>
  </div>

  <!-- Progress Section -->
  <div class="p-4">
    <div class="flex items-center justify-between">
      <h3 class="text-sm font-medium tracking-tight">Progress</h3>
      <button class="text-xs px-2 py-1 rounded-md bg-neutral-100 border border-neutral-200 hover:bg-neutral-50 inline-flex items-center gap-1">
        <span>Details</span>
        <i data-lucide="chevron-down" class="w-3.5 h-3.5"></i>
      </button>
    </div>

    <!-- Legend -->
    <div class="mt-3 grid grid-cols-3 gap-2 text-xs">
      <div class="flex items-center gap-2">
        <span class="h-2 w-2 rounded-full bg-neutral-400"></span>
        <span>Planned</span>
      </div>
      <div class="flex items-center gap-2">
        <span class="h-2 w-2 rounded-full bg-amber-500"></span>
        <span>Started</span>
      </div>
      <div class="flex items-center gap-2">
        <span class="h-2 w-2 rounded-full bg-indigo-600"></span>
        <span>Completed</span>
      </div>
    </div>

    <!-- Chart Container -->
    <div class="mt-4 rounded-2xl border border-neutral-200 bg-white p-3">
      <div class="relative h-[220px]">
        <canvas
          id="projectChart"
          data-chart-type="line"
          data-chart-labels='{{ project.chart_labels | json }}'
          data-chart-planned='{{ project.chart_planned | json }}'
          data-chart-started='{{ project.chart_started | json }}'
          data-chart-completed='{{ project.chart_completed | json }}'
        ></canvas>
      </div>
    </div>

    <!-- Segmented Control -->
    <div class="mt-5 grid grid-cols-3 gap-2">
      <button
        class="text-sm h-9 rounded-md border border-neutral-200 transition-colors"
        :class="activeTab === 'assignees' ? 'bg-neutral-900 text-white' : 'bg-white hover:bg-neutral-50'"
        @click="activeTab = 'assignees'"
      >
        Assignees
      </button>
      <button
        class="text-sm h-9 rounded-md border border-neutral-200 transition-colors"
        :class="activeTab === 'labels' ? 'bg-neutral-900 text-white' : 'bg-white hover:bg-neutral-50'"
        @click="activeTab = 'labels'"
      >
        Labels
      </button>
      <button
        class="text-sm h-9 rounded-md border border-neutral-200 transition-colors"
        :class="activeTab === 'status' ? 'bg-neutral-900 text-white' : 'bg-white hover:bg-neutral-50'"
        @click="activeTab = 'status'"
      >
        Status
      </button>
    </div>

    <!-- Assignees Tab Content -->
    <div class="mt-4 space-y-2" v-show="activeTab === 'assignees'">
      <!-- Unassigned Tasks -->
      <div class="flex items-center justify-between rounded-lg border border-neutral-200 bg-white px-3 py-2">
        <div class="flex items-center gap-2">
          <i data-lucide="circle" class="w-3.5 h-3.5 text-neutral-400"></i>
          <span class="text-sm">No assignee</span>
        </div>
        <div class="text-xs text-neutral-600 flex items-center gap-2">
          <i data-lucide="gauge" class="w-3.5 h-3.5"></i>
          {{ project.unassigned_percentage }}% of {{ project.unassigned_count }}
        </div>
      </div>

      <!-- Assigned Users List -->
      <div loopsource="project.assigned_users_stats" loopvariable="user_stat">
        <div class="flex items-center justify-between rounded-lg border border-neutral-200 bg-white px-3 py-2">
          <div class="flex items-center gap-2">
            <img
              :src="user_stat.user.avatar"
              :alt="user_stat.user.display_name"
              class="h-5 w-5 rounded-full object-cover"
            >
            <span class="text-sm">{{ user_stat.user.display_name }}</span>
          </div>
          <div class="text-xs text-neutral-600 flex items-center gap-2">
            <i data-lucide="gauge" class="w-3.5 h-3.5"></i>
            {{ user_stat.completion_percentage }}% of {{ user_stat.task_count }}
          </div>
        </div>
      </div>
    </div>

    <!-- Labels Tab Content -->
    <div class="mt-4 space-y-2" v-show="activeTab === 'labels'">
      <div loopsource="project.label_stats" loopvariable="label_stat">
        <div class="flex items-center justify-between rounded-lg border border-neutral-200 bg-white px-3 py-2">
          <div class="flex items-center gap-2">
            <i data-lucide="tag" class="w-3.5 h-3.5 text-neutral-500"></i>
            <span class="text-sm">{{ label_stat.label_name }}</span>
          </div>
          <div class="text-xs text-neutral-600">
            {{ label_stat.task_count }} tasks
          </div>
        </div>
      </div>
    </div>

    <!-- Status Tab Content -->
    <div class="mt-4 space-y-2" v-show="activeTab === 'status'">
      <div loopsource="project.status_stats" loopvariable="status_stat">
        <div class="flex items-center justify-between rounded-lg border border-neutral-200 bg-white px-3 py-2">
          <div class="flex items-center gap-2">
            <span
              class="h-2.5 w-2.5 rounded-full"
              :class="{
                'bg-amber-400 ring-4 ring-amber-100': status_stat.status === 'in-progress',
                'bg-yellow-400 ring-4 ring-yellow-100': status_stat.status === 'todo',
                'bg-indigo-500 ring-4 ring-indigo-100': status_stat.status === 'completed',
                'bg-neutral-400 ring-4 ring-neutral-100': !status_stat.status
              }"
            ></span>
            <span class="text-sm">{{ status_stat.status_name }}</span>
          </div>
          <div class="text-xs text-neutral-600">
            {{ status_stat.task_count }} tasks
          </div>
        </div>
      </div>
    </div>
  </div>
</aside>
